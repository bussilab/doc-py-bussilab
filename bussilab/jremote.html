<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
<meta name="generator" content="pdoc3 0.11.5">
<title>bussilab.jremote API documentation</title>
<meta name="description" content="Module implementing tools for remote jupyter connections …">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/sanitize.min.css" integrity="sha512-y1dtMcuvtTMJc1yPgEqF0ZjQbhnc/bFhyvIyVNb9Zk5mIGtqVaAB1Ttl28su8AvFMOY0EwRbAe+HCLqj6W7/KA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/typography.min.css" integrity="sha512-Y1DYSb995BAfxobCkKepB1BqJJTPrOp3zPL74AWFugHHmmdcvO+C48WLrUOlhGMc0QG7AE3f7gmvvcrmX2fDoA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:1.5em;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:2em 0 .50em 0}h3{font-size:1.4em;margin:1.6em 0 .7em 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .2s ease-in-out}a:visited{color:#503}a:hover{color:#b62}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900;font-weight:bold}pre code{font-size:.8em;line-height:1.4em;padding:1em;display:block}code{background:#f3f3f3;font-family:"DejaVu Sans Mono",monospace;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source > summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible;min-width:max-content}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em 1em;margin:1em 0}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul ul{padding-left:1em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js" integrity="sha512-D9gUyxqja7hBtkWpPWGt9wfbfaMGVt9gnyCvYa+jojwwPHLCzUm5i8rpk7vD7wNee9bA35eYIjobYPaQuKS1MQ==" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => {
hljs.configure({languages: ['bash', 'css', 'diff', 'graphql', 'ini', 'javascript', 'json', 'plaintext', 'python', 'python-repl', 'rust', 'shell', 'sql', 'typescript', 'xml', 'yaml']});
hljs.highlightAll();
/* Collapse source docstrings */
setTimeout(() => {
[...document.querySelectorAll('.hljs.language-python > .hljs-string')]
.filter(el => el.innerHTML.length > 200 && ['"""', "'''"].includes(el.innerHTML.substring(0, 3)))
.forEach(el => {
let d = document.createElement('details');
d.classList.add('hljs-string');
d.innerHTML = '<summary>"""</summary>' + el.innerHTML.substring(3);
el.replaceWith(d);
});
}, 100);
})</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>bussilab.jremote</code></h1>
</header>
<section id="section-intro">
<p>Module implementing tools for remote jupyter connections.</p>
<p>This module contains some utilities that are mostly designed
to be used as command line tools. The interface of the functions defined in
this module is subject to changes. One should instead use the subcommands
<code>jrun</code> and <code>jremote</code> in the <a href="cli_documentation.html">cli_documentation</a>
submodule.</p>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="bussilab.jremote.find_free_port"><code class="name flex">
<span>def <span class="ident">find_free_port</span></span>(<span>)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def find_free_port():
    &#34;&#34;&#34;Returns the number of a free port.&#34;&#34;&#34;
    with closing(socket.socket(socket.AF_INET, socket.SOCK_STREAM)) as s:
        s.bind((&#39;&#39;, 0))
        s.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
        return s.getsockname()[1]</code></pre>
</details>
<div class="desc"><p>Returns the number of a free port.</p></div>
</dd>
<dt id="bussilab.jremote.remote"><code class="name flex">
<span>def <span class="ident">remote</span></span>(<span>server: str,<br>python_exec: str = 'python',<br>dry_run: bool = False,<br>list_only: bool = False,<br>server_url: str = '',<br>port: int = 0,<br>index: int = 0,<br>open_cmd: str = '')</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def remote(server: str,
           python_exec: str = &#34;python&#34;,
           dry_run: bool = False,
           list_only: bool = False,
           server_url: str =&#34;&#34;,
           port: int = 0,
           index: int = 0,
           open_cmd: str = &#34;&#34;):

    cmd =  &#34;( &#34; + python_exec + &#34; -m jupyter notebook list 2&gt; /dev/null ) ;&#34;
    cmd += &#34;echo x ;&#34;
    cmd += &#34;( &#34; + python_exec + &#34; -m jupyterlab list 2&gt;&amp;1 ) ;&#34; # needed for jupyter-lab list 3.6

    print(&#34;server:&#34;, server)
    print(&#34;cmd:&#34;, cmd)

    if dry_run and list_only:
        return

    if server_url == &#34;&#34;:
        ll = []
        ll_localhost = []
        args = [&#39;ssh&#39;, server, cmd]
        ll_type = []
        found_lab=False

        for l in subprocess.run(args,
                                stdout=subprocess.PIPE,
                                stderr=subprocess.PIPE,
                                universal_newlines=True,
                                check=True).stdout.split(&#39;\n&#39;):
            l=re.sub(r&#34;^\[JupyterServerListApp\] &#34;,&#34;&#34;,l) # needed for newer jupyter-lab list 3.6
            if re.match(&#34;^http&#34;, l):
                ll.append(re.sub(&#34;localhost&#34;, server, l))
                ll_localhost.append(l)
                if found_lab:
                    ll_type.append(&#34;(L)&#34;)
                else:
                    ll_type.append(&#34;(N)&#34;)

            if l == &#34;x&#34;:
                found_lab = True

        for i in range(len(ll)):
            print(str(i+1)+&#34;) &#34;+ll[i]+&#34; &#34;+ll_type[i])

        if list_only:
            return

        if len(ll_localhost) == 1:
            index = 1

        if index == 0:
            while True:
                sys.stdout.write(&#34;Choose a notebook or interrupt (^c):&#34;)
                sys.stdout.flush()
                iii = sys.stdin.readline()
                try:
                    index = int(iii)
                except ValueError:
                    print(&#34;Cannot parse &#34; + iii.strip() + &#34;, try again.&#34;)
                if index&gt;=1 and index&lt;=len(ll_localhost):
                    print(index)
                    break
                print(&#34;Index &#34; + str(index) + &#34; out of range, try again.&#34;)

        url = ll_localhost[index-1].split()[0]
    else:
        url = server_url

    print(&#34;Chosen url:&#34;, url)

    if not re.match(r&#34;^http://localhost:[0-9]*/\?token=[0-9a-f]*$&#34;, url):
        raise Exception(&#34;URL &#34;+url+&#34; looks incorrectly formatted&#34;)

    server_port = re.sub(&#34;^http://localhost:&#34;, &#34;&#34;, url)
    server_port = re.sub(&#34;/.*$&#34;, &#34;&#34;, server_port)

    if port == 0:
        port = find_free_port()

    ssh_cmd = [&#34;ssh&#34;, &#34;-NL&#34;, str(port) + &#34;:localhost:&#34; + str(server_port), server]

    xopen_cmd = [] # list rather than string

    if open_cmd == &#34;&#34;:
        plat = platform.system()
        if plat == &#34;Darwin&#34;:
            xopen_cmd.append(&#34;open&#34;)
        elif plat == &#34;Linux&#34;:
            xopen_cmd.append(&#34;xdg-open&#34;)
        else:
            raise Exception(&#34;Unknown platform &#34; + plat)
    else:
        xopen_cmd = [open_cmd]

    xopen_cmd.append(re.sub(&#34;:&#34; + str(server_port), &#34;:&#34; + str(port), url))
    print(&#34;open_cmd:&#34;, &#39; &#39;.join(xopen_cmd))
    print(&#34;ssh:&#34;, &#39; &#39;.join(ssh_cmd))
    if dry_run:
        print(xopen_cmd)
    else:
        ssh = subprocess.Popen(ssh_cmd)
        try:
            print(&#34;Don&#39;t kill this terminal or you will be disconnected!&#34;)
            time.sleep(1)
            subprocess.call(xopen_cmd)
            print(&#34;Use CTRL+c to kill the connection&#34;)
        except KeyboardInterrupt:
            print(&#34;Interrupted&#34;)
        finally:
            try:
                ssh.communicate()
            except KeyboardInterrupt:
                print(&#34;Interrupted&#34;)</code></pre>
</details>
<div class="desc"></div>
</dd>
<dt id="bussilab.jremote.run_server"><code class="name flex">
<span>def <span class="ident">run_server</span></span>(<span>dry_run: bool = False,<br>port: int = 0,<br>screen_cmd: str = 'screen',<br>screen_log: str = '',<br>no_screen: bool = False,<br>keep_ld_library_path: bool = True,<br>python_exec: str = '',<br>sockname: str = '(path):(port):jupyter',<br>lab: bool = False,<br>detach: bool = False)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def run_server(dry_run: bool = False,
               port: int = 0,
               screen_cmd: str = &#34;screen&#34;,
               screen_log: str = &#34;&#34;,
               no_screen: bool = False,
               keep_ld_library_path: bool = True,
               python_exec: str = &#34;&#34;,
               sockname: str = &#34;(path):(port):jupyter&#34;,
               lab: bool = False,
               detach: bool = False):
    &#34;&#34;&#34;Runs a jupyter server inside a screen command.

       This function is only designed to be used as a command line
       tool.
    &#34;&#34;&#34;
    if python_exec == &#34;&#34;:
        python_exec = sys.executable
    print(&#34;python_exec:&#34;, python_exec)
    if port == 0:
        port = find_free_port()
    print(&#34;port:&#34;, port)
    cmd = []
    if not no_screen:
        cmd.extend(shlex.split(screen_cmd)) # allows screen_cmd to contain space separated options
        if detach:
            cmd.append(&#34;-d&#34;)
        if screen_log != &#34;&#34;:
            cmd.append(&#34;-L&#34;)
            if screen_log != &#34;screenlog.0&#34;:
              cmd.append(&#34;-Logfile&#34;)
              cmd.append(screen_log)
        cmd.append(&#34;-m&#34;)
        cmd.append(&#34;-h&#34;)
        cmd.append(&#34;100000&#34;) # scrollback
        cmd.append(&#34;-S&#34;)
        cmd.append(_adjust_sockname(sockname,port))
        if keep_ld_library_path and &#39;LD_LIBRARY_PATH&#39; in os.environ:
            cmd.append(&#34;/usr/bin/env&#34;)
            cmd.append(&#34;LD_LIBRARY_PATH=&#34; + os.environ[&#34;LD_LIBRARY_PATH&#34;])
    cmd.extend(shlex.split(python_exec)) # allows python_exec to contain space separated options
    cmd.append(&#34;-m&#34;)
    if lab:
        cmd.append(&#34;jupyterlab&#34;)
    else:
        cmd.append(&#34;jupyter&#34;)
        cmd.append(&#34;notebook&#34;)
    cmd.append(&#34;--no-browser&#34;)
    cmd.append(&#34;--port=&#34; + str(port))
    print(&#34;cmd:&#34;, cmd)
    if dry_run:
        return
    subprocess.call(cmd)</code></pre>
</details>
<div class="desc"><p>Runs a jupyter server inside a screen command.</p>
<p>This function is only designed to be used as a command line
tool.</p></div>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="bussilab" href="index.html">bussilab</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="bussilab.jremote.find_free_port" href="#bussilab.jremote.find_free_port">find_free_port</a></code></li>
<li><code><a title="bussilab.jremote.remote" href="#bussilab.jremote.remote">remote</a></code></li>
<li><code><a title="bussilab.jremote.run_server" href="#bussilab.jremote.run_server">run_server</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.11.5</a>.</p>
</footer>
</body>
</html>
